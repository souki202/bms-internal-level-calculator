# 仕様

## songdata.dbの中身

テーブル
- folder
  - beatorajaで使用するフォルダ分け。無視で良い
- song
  - 楽曲の基本的な情報が入っている

### songテーブル

#### 全カラム一覧

- md5, sha256, title, subtitle, genre, artist, subartist, tag, path, folder, stagefile, banner, backbmp, preview, parent, level, difficulty, maxbpm, minbpm, length, mode, judge, feature, content, date, favorite, adddate, notes, charthash

#### 必要なフィールド

- path: text
- title: text
- subtitle: text
- genre: text
- artist: text
- subartist: string
- md5: text
- sha256: text
- charthash: text
- content: integer
- stagefile: text
- notes: integer

解析では読み込んだうえで使用するため、bmsファイルの在り処以外のフィールドは気にする必要は無い

## bmsファイルの構造

BMSは主に、

- BMSファイル(〜.bms、〜.bme、〜.bmlなど)
- 音声データ(〜.wavまたは〜.oggファイルの集まり)
- BGAデータ(〜.bmpや〜.pngなどの画像データの集まりか、あるいは〜.mpegなどの映像データ)

でできている
bmsファイルはおおよそ次のような構造でできている

```
*---------------------- HEADER FIELD
#PLAYER 1
#GENRE Trance

・・・

#TOTAL 400
%URL

#WAV01 kick1.wav
#WAV02 vocal1.wav

・・・

#WAVF7 bgm5.wav

#BMP01 white.bmp
#BMP02 aa.bmp

・・・

#BMPFF fin.bmp

*---------------------- MAIN DATA FIELD

#00101:4F
#00104:0102030401020304
#00111:01010101

・・・

#07115:D2
```

- 行頭に必ず書く記号は#、%、*の3種類。
  - このうち最も重要なのが#から始まるコマンド。ヘッダや譜面データを記述するのに使われる。
  - %から始まるコマンドはBMSデータと直接関係はないが、作者のサイトやアドレスを補足するのに使われる。
  - *から始まる文はコメントと見なされ、BMSの実データとして読み込まれない。
- #PLAYERや#WAV??などは「ヘッダ」と呼ばれるデータで、主にBMSに関する基本的な情報(曲タイトルやBPMなど)を設定したり、プレーヤー上で使用する音声ファイルやBGAファイルを指定したりする。
- #00101:〜などの文字列はメインデータで、実際の譜面データが記録されており、プレーヤーはこのデータに沿って音を鳴らしたりノーツを配置したりBGA画像を表示したりする。

### 詳細仕様

BMS仕様書.mdを参照

## 実装したい内容

一定以上の難易度の譜面について、譜面定数を計算し、仕分ける
譜面定数の1~25の範囲は、bmsにおける発狂難易度表★1~25と同じ基準とする
簡単な譜面では、譜面定数はマイナスになる場合もあり、★25より難しい譜面では25より高い値になる
オプションは、RANDOMのイージーゲージの場合とする

### 仕分ける対象

次の条件をすべて満たすものを解析対象にする

- `#TOTAL`が250以上
- `#RANK`が2か3
- `#PLAYER 1`である
- 7keyである
  - 大まかに分けると5keyか7keyの2種類で、譜面を解析し、6, 7番目のキーにノーツが存在するかどうかで判定
- notesが1000以上5000未満
- 譜面のスクラッチの数が合計ノーツの1/20以下
- ロングノーツの数が合計ノーツの1/20以下


```json
{
    "folder": [
        {
            "class": "bms.player.beatoraja.TableData$TableFolder",
            "name": "譜面定数の値",
            "songs": [
                {
                    "class": "bms.player.beatoraja.song.SongData",
                    "title": "Berry Go!!",
                    "subtitle": "[Other]",
                    "genre": "HYBRID J-POP",
                    "artist": "Freezer feat. 妃苺",
                    "subartist": "obj:Omino",
                    "md5": "d975db5994c9f4f5b67fdacee4f50989",
                    "sha256": "6976f54de97b7f4ee20d304986073b926dfa3e923f4ef0efc5e334992e9831ea",
                    "content": 3,
                    "charthash": "a8f6b03ad1c6bc2f55651a59ed938a95588dc75d567efe4b8ab39f187ccc1667"
                },
                {
                    "class": "bms.player.beatoraja.song.SongData",
                    "title": "B e l i - R[HYPER]",
                    "genre": "PSY-ANTHEM",
                    "artist": "+45",
                    "md5": "3f62ed3c2efa69f0dee494d308b01ccd",
                    "sha256": "4d1c3a4c2ec6b2570ca78656748a0e7161078dd12f0073d57d743b744d27be77",
                    "content": 3,
                    "stagefile": "beli_d.png",
                    "charthash": "66181aeba31e79298ed531602be187a0bcf6b2d01aaf337fd53d9c4fafde9688"
                },
                {
                    "class": "bms.player.beatoraja.song.SongData",
                    "title": "Spinel",
                    "subtitle": "［7key/Another］",
                    "genre": "Hardstyle",
                    "artist": "Juuris(vocal:紲星あかり)",
                    "md5": "f3c52602e37d7567cc33cca7f06b3f66",
                    "sha256": "7e5e1c4ad6ab2d418bdce6ce617815f4f9913b5d9f610866d8cceddc525ac058",
                    "content": 1,
                    "charthash": "2eea1aa4202c79b96b9d289f7fc7fe5816dee8089b273fb2029b8c6204845be5"
                },
                {
                    "class": "bms.player.beatoraja.song.SongData",
                    "title": "オトゲラヴ！ [BEGINNER7]",
                    "genre": "A-POP",
                    "artist": "ねこみりん feat.小宮真央×みゆ×えみゅう。",
                    "subartist": "Movie:kkkfff2 / Illust:永山ゆうのん",
                    "md5": "90295edd7ebee4555e7847cc7de4fd8f",
                    "sha256": "311aa96a02cd69f9127e9609196a8817c771702e2966b19c97bd30d39d27347d",
                    "content": 3,
                    "stagefile": "otogelove_title.png",
                    "banner": "otogelove_banner.png",
                    "charthash": "e400bcc8d432973158bba3e8d2e5ff58f8ccea4f71f19b35746a5503e42edc8f"
                }
            ]
        }
    ],
}
```
